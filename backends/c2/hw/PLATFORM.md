# Porting C2 to a new board / configuration

An idiomatic approach to defining a new C2 configuration is to create a directory `yourboard` in `backends/c2/hw/`,
and add at least the following files:

* `socsignals.v` - what to add to the top module input/output, included from `soctop.v`, in addition to the existing `sys_clk_in` and `sys_reset` inputs.
* `socmodules.v` - included into the top module body in `soctop.v`. Define your memory-mapped devices here. Also, define `clk` and `rst` wires and derive them
from the top level inputs as you like (instantiate a PLL, use a clock divider, whatever).
* `socdata.v` - included into a memory-mapped device output selection in `soctop.v`, add `data_bus_strobe_yourdevice?data_bus_in_yourdevice` for every readable
memory-mapped device you defined.
* `soccpusignals.v` - inputs and outputs you want to add to your main CPU instance, included from `core.v`
* `soccpusignalsin.v` - included from `soctop.v` main CPU core instantiation. 
* `defines.v` - additional definitions, included by `core.v` and `soctop.v`

You must also define a module `socram` with the following interface:
```
module socram(input clk,
              input             rst,

              output reg [31:0] data_a,
              input [31:0]      addr_a,
              
              output reg [31:0] data_b,
              output reg        strobe_b,
              input [31:0]      addr_b,
              input [31:0]      data_b_in,
              input [31:0]      data_b_we)
```

Make sure that the implementation of `socram` initialise the memory with a hex file generated by the CLike compiler.

For a minimal example, see `backends/c2/hw/verilator`.


## Flow configuration

Include the following files into your build:

* `backends/c2/hw/rtl/core.v` - CPU core
* `backends/c2/hw/rtl/soctop.v` - toplevel module
* `backends/c2/hw/rtl/regfile.v` - register file for the CPU cores

Set the top level module name to `c2soc`.

Make sure the following Verilog include search paths are configured for your target board flow:

* `backends/c2/hw/rtl`
* `backends/c2/hw/yourboard`
* `path-to-your-custom-extensions-output` - e.g., `backends/c2/custom_out` for the provided HLS demo programs.

The latter must contain the following files (potentially empty), normally generated by the CLike compiler:

* `c2_custom_hoist.v`
* `c2_custom_include.v`
* `c2_custom_pipeline.v` 
* `c2_custom_reset.v` 
* `c2_custom_wait.v`




